<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>TV LIVE</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&family=Share+Tech+Mono&display=swap');
  :root{--bg:#090c10;--surface:#0f1318;--border:#1e2530;--accent:#00e5ff;--accent2:#ff3d6b;--text:#c8d6e5;--muted:#4a5568}
  *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  body{background:var(--bg);color:var(--text);font-family:'Rajdhani',sans-serif;min-height:100vh;overflow-x:hidden}
  body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(0,229,255,.025) 1px,transparent 1px),linear-gradient(90deg,rgba(0,229,255,.025) 1px,transparent 1px);background-size:40px 40px;pointer-events:none;z-index:0}
  .app{position:relative;z-index:1;display:flex;flex-direction:column;min-height:100vh}
  header{display:flex;align-items:center;gap:10px;padding:12px 14px;border-bottom:1px solid var(--border);background:rgba(9,12,16,.97);position:sticky;top:0;z-index:100}
  .logo{font-size:20px;font-weight:700;letter-spacing:3px;color:var(--accent)}
  .logo span{color:var(--accent2)}
  .badge{margin-left:auto;display:flex;align-items:center;gap:5px;font-size:10px;letter-spacing:2px;color:var(--muted)}
  .badge.on{color:var(--accent)}
  .dot{width:7px;height:7px;border-radius:50%;background:var(--muted)}
  .badge.on .dot{background:var(--accent);animation:pulse 1.5s infinite}
  @keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
  #frame-wrap{position:relative;width:100%;padding-top:56.25%;background:#000;overflow:hidden}
  #frame{position:absolute;inset:0;width:100%;height:100%;border:none}
  #placeholder{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;background:var(--surface)}
  .ring{width:70px;height:70px;border-radius:50%;border:2px solid var(--accent);display:flex;align-items:center;justify-content:center;animation:breathe 3s ease-in-out infinite}
  @keyframes breathe{0%,100%{box-shadow:0 0 15px rgba(0,229,255,.3)}50%{box-shadow:0 0 35px rgba(0,229,255,.6)}}
  .ring svg{width:28px;height:28px;fill:var(--accent);margin-left:5px}
  .ph-txt{font-size:13px;color:var(--muted);letter-spacing:3px}
  #loading{position:absolute;inset:0;background:rgba(9,12,16,.92);display:none;flex-direction:column;align-items:center;justify-content:center;gap:14px;z-index:10}
  #loading.show{display:flex}
  .spinner{width:40px;height:40px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
  .loading-txt{font-size:12px;color:var(--muted);letter-spacing:2px}
  .url-bar{display:flex;gap:8px;padding:10px 12px;background:var(--surface);border-bottom:1px solid var(--border)}
  #url-input{flex:1;background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:9px 11px;color:var(--text);font-family:'Share Tech Mono',monospace;font-size:11px;outline:none;transition:border-color .2s}
  #url-input:focus{border-color:var(--accent)}
  #url-input::placeholder{color:var(--muted)}
  .btn-go{background:linear-gradient(135deg,var(--accent),#0077ff);border:none;border-radius:6px;padding:9px 14px;color:#000;font-family:'Rajdhani',sans-serif;font-weight:700;font-size:13px;letter-spacing:1px;cursor:pointer;white-space:nowrap}
  .btn-go:active{opacity:.8}
  .info-bar{display:flex;align-items:center;padding:7px 14px;gap:8px;font-size:11px;border-bottom:1px solid var(--border);background:rgba(0,229,255,.03);color:var(--muted)}
  .info-bar b{color:var(--accent)}
  #proxy-status{margin-left:auto;font-size:10px;letter-spacing:1px;background:var(--bg);padding:3px 8px;border-radius:20px;border:1px solid var(--border)}
  .sec-label{padding:14px 14px 8px;font-size:10px;font-weight:700;letter-spacing:3px;color:var(--muted)}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;padding:0 12px 12px}
  .card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:13px 8px 11px;text-align:center;cursor:pointer;transition:border-color .2s,box-shadow .2s,transform .15s;display:flex;flex-direction:column;align-items:center;gap:5px}
  .card:active{transform:scale(.93)}
  .card.active{border-color:var(--accent);box-shadow:0 0 18px rgba(0,229,255,.2);background:rgba(0,229,255,.05)}
  .card.active .c-name{color:var(--accent)}
  .c-ico{font-size:24px}.c-name{font-size:11px;font-weight:600;color:var(--text)}.c-tag{font-size:9px;color:var(--muted);background:var(--bg);padding:2px 6px;border-radius:20px;letter-spacing:1px}
  .add-wrap{padding:0 12px 16px}
  .add-btn{width:100%;background:transparent;border:1px dashed var(--border);border-radius:10px;padding:12px;color:var(--muted);font-family:'Rajdhani',sans-serif;font-size:13px;letter-spacing:1px;cursor:pointer}
  .modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:200;display:flex;align-items:flex-end;opacity:0;pointer-events:none;transition:opacity .3s}
  .modal-bg.open{opacity:1;pointer-events:all}
  .modal{width:100%;background:var(--surface);border-top:1px solid var(--border);border-radius:16px 16px 0 0;padding:20px 16px 34px;transform:translateY(100%);transition:transform .3s;display:flex;flex-direction:column;gap:11px}
  .modal-bg.open .modal{transform:translateY(0)}
  .modal h3{font-size:15px;letter-spacing:2px;color:var(--accent)}
  .modal input{background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:11px;color:var(--text);font-size:13px;outline:none;width:100%}
  .modal input:focus{border-color:var(--accent)}
  .m-btns{display:flex;gap:8px;margin-top:4px}
  .m-cancel{flex:1;background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:11px;color:var(--muted);font-family:'Rajdhani',sans-serif;font-weight:600;cursor:pointer}
  .m-save{flex:2;background:var(--accent);border:none;border-radius:8px;padding:11px;color:#000;font-family:'Rajdhani',sans-serif;font-weight:700;letter-spacing:1px;cursor:pointer}
  .toast{position:fixed;bottom:22px;left:50%;transform:translateX(-50%) translateY(70px);background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:9px 18px;font-size:12px;letter-spacing:1px;color:var(--text);z-index:400;transition:transform .3s;white-space:nowrap;box-shadow:0 4px 20px rgba(0,0,0,.5)}
  .toast.show{transform:translateX(-50%) translateY(0)}
  .footer{padding:12px;text-align:center;font-size:10px;color:var(--muted);letter-spacing:2px}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="logo">TV<span>.</span>LIVE</div>
    <div class="badge" id="badge"><div class="dot"></div><span id="badge-txt">OFFLINE</span></div>
  </header>
  <div id="frame-wrap">
    <div id="placeholder">
      <div class="ring"><svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div>
      <div class="ph-txt">SELECCIONÃ UN CANAL</div>
    </div>
    <div id="loading"><div class="spinner"></div><div class="loading-txt" id="loading-txt">CARGANDO...</div></div>
    <!--
      CLAVE: el iframe apunta DIRECTO a la URL original (la14hd.com)
      El HTML que recibe ya viene limpio â€” el proxy eliminÃ³ los scripts
      de tiogolhd ANTES de que lleguen al navegador.
      AsÃ­ el stream .m3u8 carga desde su origen correcto sin errores.
    -->
    <iframe id="frame" style="display:none"
      allowfullscreen
      allow="autoplay; fullscreen; picture-in-picture; encrypted-media"
      referrerpolicy="no-referrer-when-downgrade">
    </iframe>
  </div>
  <div class="url-bar">
    <input id="url-input" type="url" placeholder="https://sitio.com/stream...">
    <button class="btn-go" onclick="loadChannel()">â–¶ IR</button>
  </div>
  <div class="info-bar">
    <span>ğŸ›¡ï¸ <b>Proxy anti-ads</b></span>
    <span id="proxy-status">LISTO</span>
  </div>
  <div class="sec-label">CANALES RÃPIDOS</div>
  <div class="grid" id="grid"></div>
  <div class="add-wrap"><button class="add-btn" onclick="openModal()">ï¼‹ AGREGAR CANAL</button></div>
  <div class="footer">LONGPRESS SOBRE CANAL PARA ELIMINAR</div>
</div>
<div class="modal-bg" id="modalBg">
  <div class="modal">
    <h3>NUEVO CANAL</h3>
    <input id="mName" placeholder="Nombre (ej: TyC Sports)">
    <input id="mUrl" type="url" placeholder="URL del stream">
    <input id="mIcon" placeholder="Emoji (ej: âš½) â€” opcional">
    <div class="m-btns">
      <button class="m-cancel" onclick="closeModal()">CANCELAR</button>
      <button class="m-save" onclick="saveChannel()">GUARDAR</button>
    </div>
  </div>
</div>
<div class="toast" id="toast"></div>

<script>
'use strict';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PROXY CORS gratuito â€” descarga el HTML server-side
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PROXY = 'https://api.allorigins.win/get?url=';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PASO 1: Eliminar scripts de ads del HTML crudo (regex)
// Se hace ANTES de que el navegador los vea â€” nunca llegan a ejecutar
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function stripAdScripts(html) {
  return html
    // Eliminar cualquier <script> que cargue tiogolhd o aclib
    .replace(/<script[^>]*tiogolhd[^>]*>[\s\S]*?<\/script>/gi, '')
    .replace(/<script[^>]*aclib[^>]*>[\s\S]*?<\/script>/gi, '')
    .replace(/<script[^>]*block\.js[^>]*>[\s\S]*?<\/script>/gi, '')
    // Eliminar otros ad networks conocidos
    .replace(/<script[^>]*popads\.net[^>]*>[\s\S]*?<\/script>/gi, '')
    .replace(/<script[^>]*exoclick[^>]*>[\s\S]*?<\/script>/gi, '')
    .replace(/<script[^>]*adsterra[^>]*>[\s\S]*?<\/script>/gi, '')
    .replace(/<script[^>]*propellerads[^>]*>[\s\S]*?<\/script>/gi, '')
    .replace(/<script[^>]*hilltopads[^>]*>[\s\S]*?<\/script>/gi, '')
    .replace(/<script[^>]*trafficjunky[^>]*>[\s\S]*?<\/script>/gi, '')
    .replace(/<script[^>]*clickadu[^>]*>[\s\S]*?<\/script>/gi, '')
    // Eliminar llamadas inline a aclib
    .replace(/aclib\.run\w*\s*\(\s*\{[\s\S]*?\}\s*\)\s*;?/g, '')
    // Eliminar iframes de ads
    .replace(/<iframe[^>]*tiogolhd[^>]*>[\s\S]*?<\/iframe>/gi, '')
    .replace(/<iframe[^>]*popads[^>]*>[\s\S]*?<\/iframe>/gi, '');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PASO 2: Script que se inyecta DENTRO del HTML limpio
// Por si queda algÃºn ad dinÃ¡mico que se inyecte despuÃ©s de cargar
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const AD_KILLER = `<script>
(function(){
  if(window.__ak) return;
  window.__ak = true;

  /* Neutralizar aclib por si quedÃ³ alguna referencia */
  window.aclib = { runPop:function(){}, runBanner:function(){},
                   runInterstitial:function(){}, runSlider:function(){} };

  /* Sin popups */
  window.open = function(){ return null; };

  /* Interceptar createElement para bloquear scripts inyectados dinÃ¡micamente */
  var _ce = document.createElement.bind(document);
  document.createElement = function(tag){
    var el = _ce(tag);
    if((tag+'').toLowerCase() === 'script'){
      Object.defineProperty(el, 'src', {
        set: function(v){
          if(v && (v.indexOf('tiogolhd')>-1 || v.indexOf('aclib')>-1 ||
             v.indexOf('popads')>-1 || v.indexOf('exoclick')>-1 ||
             v.indexOf('adsterra')>-1 || v.indexOf('hilltopads')>-1)){
            return; /* bloqueado */
          }
          Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,'src').set.call(this,v);
        },
        get: function(){
          return Object.getOwnPropertyDescriptor(HTMLScriptElement.prototype,'src').get.call(this);
        }
      });
    }
    return el;
  };

  /* Eliminar capas de publicidad del DOM */
  function isPlayer(el){
    var s = ((el.id||'')+(el.className||'')).toLowerCase();
    return el.tagName==='VIDEO'||el.tagName==='AUDIO'||
           (el.querySelector&&!!el.querySelector('video'))||
           s.indexOf('player')>-1||s.indexOf('jw-')>-1||s.indexOf('vjs')>-1;
  }
  function killAds(){
    if(!document.body) return;
    document.querySelectorAll('div,section,aside').forEach(function(el){
      if(isPlayer(el)) return;
      try{
        var st = getComputedStyle(el);
        if(st.display==='none') return;
        var zi = parseInt(st.zIndex)||0;
        if((st.position==='fixed'||st.position==='absolute') && zi>5){
          var r = el.getBoundingClientRect();
          if(r.width < window.innerWidth*0.25 || r.height < window.innerHeight*0.25) return;
          if(isPlayer(el)) return;
          var hasExt = Array.from(el.querySelectorAll('a[href]')).some(function(a){
            var h = a.getAttribute('href')||'';
            return h && h.indexOf('javascript')===-1 &&
                   h.indexOf(location.hostname)===-1 && /^https?:/.test(h);
          });
          if(hasExt || zi > 50){
            el.style.cssText = 'display:none!important;pointer-events:none!important';
            try{ el.remove(); }catch(e){}
          }
        }
      }catch(e){}
    });
  }

  /* Bloquear clicks en links externos */
  document.addEventListener('click', function(e){
    var t = e.target;
    for(var i=0;i<8;i++){
      if(!t || t===document.body) break;
      if(t.tagName==='A'){
        var h = t.getAttribute('href')||'';
        if(h && h.indexOf('javascript')===-1 && h.indexOf('#')===-1 &&
           h.indexOf(location.hostname)===-1 && /^https?:/.test(h)){
          e.preventDefault(); e.stopImmediatePropagation(); return;
        }
      }
      t = t.parentElement;
    }
  }, true);

  killAds();
  setInterval(killAds, 500);
  var mo = new MutationObserver(function(m){
    m.forEach(function(r){ if(r.addedNodes.length) setTimeout(killAds,60); });
  });
  function obs(){ if(document.body) mo.observe(document.body,{childList:true,subtree:true}); }
  document.body ? obs() : document.addEventListener('DOMContentLoaded', obs);
})();
<\/script>`;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MOTOR PRINCIPAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const frame       = document.getElementById('frame');
const placeholder = document.getElementById('placeholder');
const loadingEl   = document.getElementById('loading');
const loadingTxt  = document.getElementById('loading-txt');
const badge       = document.getElementById('badge');
const badgeTxt    = document.getElementById('badge-txt');
const proxyStatus = document.getElementById('proxy-status');

let activeIdx   = -1;
let currentUrl  = '';
let currentBlob = null;

function showState(s){
  placeholder.style.display = s==='ph'   ? 'flex'  : 'none';
  loadingEl.classList.toggle('show',       s==='load');
  frame.style.display       = s==='play' ? 'block' : 'none';
}

async function loadChannel(url, idx) {
  const target = url || document.getElementById('url-input').value.trim();
  if (!target) { toast('âš ï¸ IngresÃ¡ una URL'); return; }

  currentUrl = target;
  document.getElementById('url-input').value = target;
  loadingTxt.textContent = 'ELIMINANDO ADS...';
  showState('load');
  proxyStatus.textContent = 'PROCESANDO...';
  proxyStatus.style.color = '#ffaa00';

  if (idx !== undefined) { activeIdx = idx; renderGrid(); }

  try {
    // Descargar HTML via proxy (server-side, sin CORS)
    const res  = await fetch(PROXY + encodeURIComponent(target));
    if (!res.ok) throw new Error('proxy ' + res.status);
    const data = await res.json();
    let html   = data.contents;
    if (!html)  throw new Error('vacÃ­o');

    // â”€â”€ ELIMINAR scripts de ads del HTML â”€â”€
    html = stripAdScripts(html);

    // â”€â”€ Arreglar URLs relativas para que los recursos carguen bien â”€â”€
    const orig     = new URL(target);
    const basePath = orig.pathname.replace(/\/[^/]*$/, '/');
    const baseTag  = `<base href="${orig.origin}${basePath}">`;

    // â”€â”€ Inyectar base + script anti-ads â”€â”€
    const inject = baseTag + AD_KILLER;
    if      (html.includes('<head>'))       html = html.replace('<head>', '<head>' + inject);
    else if (/<head[^>]*>/.test(html))      html = html.replace(/<head[^>]*>/, m => m + inject);
    else                                    html = '<head>' + inject + '</head>' + html;

    // â”€â”€ Crear blob y cargarlo en el iframe â”€â”€
    // El iframe ahora tiene el HTML limpio pero con base href apuntando
    // al origen original â†’ el stream .m3u8 se pide a la14hd.com directo
    if (currentBlob) URL.revokeObjectURL(currentBlob);
    currentBlob = URL.createObjectURL(new Blob([html], { type: 'text/html; charset=utf-8' }));
    frame.src   = currentBlob;

    proxyStatus.textContent = 'ğŸ›¡ï¸ ADS ELIMINADOS';
    proxyStatus.style.color = 'var(--accent)';
    badge.classList.add('on');
    badgeTxt.textContent = 'EN VIVO';
    showState('play');

  } catch(e) {
    // Fallback: cargar directo sin proxy
    console.warn('Proxy fallÃ³:', e.message);
    frame.src = target;
    proxyStatus.textContent = 'âš ï¸ DIRECTO';
    proxyStatus.style.color = '#ffaa00';
    badge.classList.add('on');
    badgeTxt.textContent = 'EN VIVO';
    showState('play');
    toast('âš ï¸ Proxy no disponible, carga directa');
  }
}

frame.addEventListener('load', () => {
  if (frame.src && frame.src !== 'about:blank') showState('play');
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHANNELS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DEFAULTS = [
  {name:'ESPN 2',    url:'https://la14hd.com/vivo/canales.php?stream=espn2',     icon:'âš½',tag:'DEPORTES'},
  {name:'ESPN',      url:'https://la14hd.com/vivo/canales.php?stream=espn',      icon:'ğŸ†',tag:'DEPORTES'},
  {name:'TyC Sports',url:'https://la14hd.com/vivo/canales.php?stream=tyc',       icon:'ğŸ¯',tag:'DEPORTES'},
  {name:'Fox Sports',url:'https://la14hd.com/vivo/canales.php?stream=foxsports', icon:'ğŸ¦Š',tag:'DEPORTES'},
  {name:'TNT Sports',url:'https://la14hd.com/vivo/canales.php?stream=tntsports', icon:'ğŸ€',tag:'DEPORTES'},
  {name:'Cine AR',   url:'https://la14hd.com/vivo/canales.php?stream=cinear',    icon:'ğŸ¬',tag:'CINE'},
  {name:'A24',       url:'https://la14hd.com/vivo/canales.php?stream=a24',       icon:'ğŸ“º',tag:'NOTICIAS'},
  {name:'C5N',       url:'https://la14hd.com/vivo/canales.php?stream=c5n',       icon:'ğŸ“¡',tag:'NOTICIAS'},
  {name:'Telefe',    url:'https://la14hd.com/vivo/canales.php?stream=telefe',    icon:'ğŸ“»',tag:'GENERAL'},
];

let channels = [];
function loadChannels(){
  try{ channels=JSON.parse(localStorage.getItem('tvch_v8')||'null')||[...DEFAULTS]; }
  catch(e){ channels=[...DEFAULTS]; }
}
function saveChannels(){ localStorage.setItem('tvch_v8',JSON.stringify(channels)); }

function renderGrid(){
  const g = document.getElementById('grid');
  g.innerHTML = channels.map((ch,i) => `
    <div class="card ${i===activeIdx?'active':''}" data-i="${i}">
      <div class="c-ico">${ch.icon||'ğŸ“º'}</div>
      <div class="c-name">${ch.name}</div>
      <div class="c-tag">${ch.tag||'CUSTOM'}</div>
    </div>`).join('');
  g.querySelectorAll('.card').forEach(card => {
    const i = +card.dataset.i;
    let timer;
    card.addEventListener('click', () => loadChannel(channels[i].url, i));
    card.addEventListener('touchstart', () => { timer=setTimeout(()=>delChannel(i),700); },{passive:true});
    card.addEventListener('touchend',   () => clearTimeout(timer),{passive:true});
    card.addEventListener('touchmove',  () => clearTimeout(timer),{passive:true});
    card.addEventListener('contextmenu',e  => { e.preventDefault(); delChannel(i); });
  });
}

function delChannel(i){
  if(!confirm(`Â¿Eliminar "${channels[i].name}"?`)) return;
  channels.splice(i,1); saveChannels();
  if(activeIdx===i) activeIdx=-1; else if(activeIdx>i) activeIdx--;
  renderGrid(); toast('ğŸ—‘ï¸ Canal eliminado');
}

function openModal() { document.getElementById('modalBg').classList.add('open'); }
function closeModal(){ document.getElementById('modalBg').classList.remove('open'); }
function saveChannel(){
  const name = document.getElementById('mName').value.trim();
  const url  = document.getElementById('mUrl').value.trim();
  const icon = document.getElementById('mIcon').value.trim() || 'ğŸ“º';
  if(!name||!url){ toast('âš ï¸ Nombre y URL son obligatorios'); return; }
  channels.push({name,url,icon,tag:'CUSTOM'});
  saveChannels(); renderGrid(); closeModal();
  ['mName','mUrl','mIcon'].forEach(id=>document.getElementById(id).value='');
  toast('âœ… Canal guardado');
}
document.getElementById('modalBg').addEventListener('click',function(e){if(e.target===this)closeModal();});

let _tt;
function toast(msg){
  const el=document.getElementById('toast');
  el.textContent=msg; el.classList.add('show');
  clearTimeout(_tt); _tt=setTimeout(()=>el.classList.remove('show'),2800);
}

loadChannels();
renderGrid();
showState('ph');
</script>
</body>
</html>
