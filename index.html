<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>TV LIVE</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&family=Share+Tech+Mono&display=swap');
  :root{--bg:#090c10;--surface:#0f1318;--border:#1e2530;--accent:#00e5ff;--accent2:#ff3d6b;--text:#c8d6e5;--muted:#4a5568}
  *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  body{background:var(--bg);color:var(--text);font-family:'Rajdhani',sans-serif;min-height:100vh;overflow-x:hidden}
  body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(0,229,255,.025) 1px,transparent 1px),linear-gradient(90deg,rgba(0,229,255,.025) 1px,transparent 1px);background-size:40px 40px;pointer-events:none;z-index:0}
  .app{position:relative;z-index:1;display:flex;flex-direction:column;min-height:100vh}
  header{display:flex;align-items:center;gap:10px;padding:12px 14px;border-bottom:1px solid var(--border);background:rgba(9,12,16,.97);position:sticky;top:0;z-index:100}
  .logo{font-size:20px;font-weight:700;letter-spacing:3px;color:var(--accent)}
  .logo span{color:var(--accent2)}
  .badge{margin-left:auto;display:flex;align-items:center;gap:5px;font-size:10px;letter-spacing:2px;color:var(--muted)}
  .badge.on{color:var(--accent)}
  .dot{width:7px;height:7px;border-radius:50%;background:var(--muted)}
  .badge.on .dot{background:var(--accent);animation:pulse 1.5s infinite}
  @keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}
  #frame-wrap{position:relative;width:100%;padding-top:56.25%;background:#000;overflow:hidden}
  #frame{position:absolute;inset:0;width:100%;height:100%;border:none}
  #placeholder{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;background:var(--surface)}
  .ring{width:70px;height:70px;border-radius:50%;border:2px solid var(--accent);display:flex;align-items:center;justify-content:center;animation:breathe 3s ease-in-out infinite}
  @keyframes breathe{0%,100%{box-shadow:0 0 15px rgba(0,229,255,.3)}50%{box-shadow:0 0 35px rgba(0,229,255,.6)}}
  .ring svg{width:28px;height:28px;fill:var(--accent);margin-left:5px}
  .ph-txt{font-size:13px;color:var(--muted);letter-spacing:3px}
  #loading{position:absolute;inset:0;background:rgba(9,12,16,.92);display:none;flex-direction:column;align-items:center;justify-content:center;gap:14px;z-index:10}
  #loading.show{display:flex}
  .spinner{width:40px;height:40px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
  .loading-txt{font-size:12px;color:var(--muted);letter-spacing:2px}
  .url-bar{display:flex;gap:8px;padding:10px 12px;background:var(--surface);border-bottom:1px solid var(--border)}
  #url-input{flex:1;background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:9px 11px;color:var(--text);font-family:'Share Tech Mono',monospace;font-size:11px;outline:none;transition:border-color .2s}
  #url-input:focus{border-color:var(--accent)}
  #url-input::placeholder{color:var(--muted)}
  .btn-go{background:linear-gradient(135deg,var(--accent),#0077ff);border:none;border-radius:6px;padding:9px 14px;color:#000;font-family:'Rajdhani',sans-serif;font-weight:700;font-size:13px;letter-spacing:1px;cursor:pointer;white-space:nowrap}
  .btn-go:active{opacity:.8}
  .info-bar{display:flex;align-items:center;padding:7px 14px;gap:8px;font-size:11px;border-bottom:1px solid var(--border);background:rgba(0,229,255,.03);color:var(--muted)}
  .info-bar b{color:var(--accent)}
  #sw-status{margin-left:auto;font-size:10px;letter-spacing:1px;background:var(--bg);padding:3px 8px;border-radius:20px;border:1px solid var(--border)}
  .sec-label{padding:14px 14px 8px;font-size:10px;font-weight:700;letter-spacing:3px;color:var(--muted)}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;padding:0 12px 12px}
  .card{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:13px 8px 11px;text-align:center;cursor:pointer;transition:border-color .2s,box-shadow .2s,transform .15s;display:flex;flex-direction:column;align-items:center;gap:5px}
  .card:active{transform:scale(.93)}
  .card.active{border-color:var(--accent);box-shadow:0 0 18px rgba(0,229,255,.2);background:rgba(0,229,255,.05)}
  .card.active .c-name{color:var(--accent)}
  .c-ico{font-size:24px}.c-name{font-size:11px;font-weight:600;color:var(--text)}.c-tag{font-size:9px;color:var(--muted);background:var(--bg);padding:2px 6px;border-radius:20px;letter-spacing:1px}
  .add-wrap{padding:0 12px 16px}
  .add-btn{width:100%;background:transparent;border:1px dashed var(--border);border-radius:10px;padding:12px;color:var(--muted);font-family:'Rajdhani',sans-serif;font-size:13px;letter-spacing:1px;cursor:pointer}
  .modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:200;display:flex;align-items:flex-end;opacity:0;pointer-events:none;transition:opacity .3s}
  .modal-bg.open{opacity:1;pointer-events:all}
  .modal{width:100%;background:var(--surface);border-top:1px solid var(--border);border-radius:16px 16px 0 0;padding:20px 16px 34px;transform:translateY(100%);transition:transform .3s;display:flex;flex-direction:column;gap:11px}
  .modal-bg.open .modal{transform:translateY(0)}
  .modal h3{font-size:15px;letter-spacing:2px;color:var(--accent)}
  .modal input{background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:11px;color:var(--text);font-size:13px;outline:none;width:100%}
  .modal input:focus{border-color:var(--accent)}
  .m-btns{display:flex;gap:8px;margin-top:4px}
  .m-cancel{flex:1;background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:11px;color:var(--muted);font-family:'Rajdhani',sans-serif;font-weight:600;cursor:pointer}
  .m-save{flex:2;background:var(--accent);border:none;border-radius:8px;padding:11px;color:#000;font-family:'Rajdhani',sans-serif;font-weight:700;letter-spacing:1px;cursor:pointer}
  .toast{position:fixed;bottom:22px;left:50%;transform:translateX(-50%) translateY(70px);background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:9px 18px;font-size:12px;letter-spacing:1px;color:var(--text);z-index:400;transition:transform .3s;white-space:nowrap;box-shadow:0 4px 20px rgba(0,0,0,.5)}
  .toast.show{transform:translateX(-50%) translateY(0)}
  .footer{padding:12px;text-align:center;font-size:10px;color:var(--muted);letter-spacing:2px}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="logo">TV<span>.</span>LIVE</div>
    <div class="badge" id="badge"><div class="dot"></div><span id="badge-txt">OFFLINE</span></div>
  </header>
  <div id="frame-wrap">
    <div id="placeholder">
      <div class="ring"><svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div>
      <div class="ph-txt">SELECCION√Å UN CANAL</div>
    </div>
    <div id="loading"><div class="spinner"></div><div class="loading-txt" id="loading-txt">CARGANDO...</div></div>
    <iframe id="frame" style="display:none"
      allowfullscreen
      allow="autoplay; fullscreen; picture-in-picture; encrypted-media"
      referrerpolicy="no-referrer-when-downgrade">
    </iframe>
  </div>
  <div class="url-bar">
    <input id="url-input" type="url" placeholder="https://sitio.com/stream...">
    <button class="btn-go" onclick="loadChannel()">‚ñ∂ IR</button>
  </div>
  <div class="info-bar">
    <span>üõ°Ô∏è <b>Bloqueador de red</b></span>
    <span id="sw-status">INICIANDO...</span>
  </div>
  <div class="sec-label">CANALES R√ÅPIDOS</div>
  <div class="grid" id="grid"></div>
  <div class="add-wrap"><button class="add-btn" onclick="openModal()">Ôºã AGREGAR CANAL</button></div>
  <div class="footer">LONGPRESS SOBRE CANAL PARA ELIMINAR</div>
</div>
<div class="modal-bg" id="modalBg">
  <div class="modal">
    <h3>NUEVO CANAL</h3>
    <input id="mName" placeholder="Nombre (ej: TyC Sports)">
    <input id="mUrl" type="url" placeholder="URL del stream">
    <input id="mIcon" placeholder="Emoji (ej: ‚öΩ) ‚Äî opcional">
    <div class="m-btns">
      <button class="m-cancel" onclick="closeModal()">CANCELAR</button>
      <button class="m-save" onclick="saveChannel()">GUARDAR</button>
    </div>
  </div>
</div>
<div class="toast" id="toast"></div>

<script>
'use strict';

const swStatus = document.getElementById('sw-status');

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// REGISTRAR SERVICE WORKER desde archivo sw.js de GitHub Pages
// Desde HTTPS con dominio propio funciona perfectamente
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function registerSW() {
  if (!('serviceWorker' in navigator)) {
    swStatus.textContent = '‚ö†Ô∏è NO SOPORTADO';
    swStatus.style.color = 'var(--accent2)';
    return;
  }
  try {
    // sw.js est√° en la ra√≠z del repo ‚Äî mismo dominio que esta p√°gina
    const reg = await navigator.serviceWorker.register('./sw.js', { scope: './' });
    await navigator.serviceWorker.ready;
    swStatus.textContent = 'üõ°Ô∏è ACTIVO';
    swStatus.style.color = 'var(--accent)';
    swStatus.style.borderColor = 'var(--accent)';
    console.log('SW activo:', reg.scope);
  } catch(e) {
    swStatus.textContent = '‚ö†Ô∏è ERROR: ' + e.message;
    swStatus.style.color = 'var(--accent2)';
    console.error('SW error:', e);
  }
}

// Bloqueo adicional en el padre
window.open = () => null;
window.addEventListener('blur', () => setTimeout(() => { try{ window.focus(); }catch(e){} }, 150));

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PLAYER ‚Äî carga el canal DIRECTO en el iframe
// El Service Worker intercepta las peticiones de tiogolhd.com
// y devuelve vac√≠o ‚Äî el stream .m3u8 pasa sin problemas
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const frame       = document.getElementById('frame');
const placeholder = document.getElementById('placeholder');
const loadingEl   = document.getElementById('loading');
const loadingTxt  = document.getElementById('loading-txt');
const badge       = document.getElementById('badge');
const badgeTxt    = document.getElementById('badge-txt');

let activeIdx = -1;

function showState(s){
  placeholder.style.display = s==='ph'   ? 'flex'  : 'none';
  loadingEl.classList.toggle('show',       s==='load');
  frame.style.display       = s==='play' ? 'block' : 'none';
}

async function loadChannel(url, idx) {
  const target = url || document.getElementById('url-input').value.trim();
  if (!target) { toast('‚ö†Ô∏è Ingres√° una URL'); return; }

  document.getElementById('url-input').value = target;
  loadingTxt.textContent = 'CARGANDO STREAM...';
  showState('load');

  if (idx !== undefined) { activeIdx = idx; renderGrid(); }

  // Cargar directo ‚Äî el SW bloquea los ads a nivel de red
  frame.src = 'about:blank';
  await new Promise(r => setTimeout(r, 100));
  frame.src = target;

  badge.classList.add('on');
  badgeTxt.textContent = 'EN VIVO';
  setTimeout(() => showState('play'), 2000);
}

frame.addEventListener('load', () => {
  if (frame.src && frame.src !== 'about:blank') showState('play');
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CHANNELS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const DEFAULTS = [
  {name:'ESPN 2',    url:'https://la14hd.com/vivo/canales.php?stream=espn2',     icon:'‚öΩ',tag:'DEPORTES'},
  {name:'ESPN',      url:'https://la14hd.com/vivo/canales.php?stream=espn',      icon:'üèÜ',tag:'DEPORTES'},
  {name:'TyC Sports',url:'https://la14hd.com/vivo/canales.php?stream=tyc',       icon:'üéØ',tag:'DEPORTES'},
  {name:'Fox Sports',url:'https://la14hd.com/vivo/canales.php?stream=foxsports', icon:'ü¶ä',tag:'DEPORTES'},
  {name:'TNT Sports',url:'https://la14hd.com/vivo/canales.php?stream=tntsports', icon:'üèÄ',tag:'DEPORTES'},
  {name:'Cine AR',   url:'https://la14hd.com/vivo/canales.php?stream=cinear',    icon:'üé¨',tag:'CINE'},
  {name:'A24',       url:'https://la14hd.com/vivo/canales.php?stream=a24',       icon:'üì∫',tag:'NOTICIAS'},
  {name:'C5N',       url:'https://la14hd.com/vivo/canales.php?stream=c5n',       icon:'üì°',tag:'NOTICIAS'},
  {name:'Telefe',    url:'https://la14hd.com/vivo/canales.php?stream=telefe',    icon:'üìª',tag:'GENERAL'},
];

let channels = [];
function loadChannels(){
  try{ channels=JSON.parse(localStorage.getItem('tvch_v9')||'null')||[...DEFAULTS]; }
  catch(e){ channels=[...DEFAULTS]; }
}
function saveChannels(){ localStorage.setItem('tvch_v9',JSON.stringify(channels)); }

function renderGrid(){
  const g = document.getElementById('grid');
  g.innerHTML = channels.map((ch,i) => `
    <div class="card ${i===activeIdx?'active':''}" data-i="${i}">
      <div class="c-ico">${ch.icon||'üì∫'}</div>
      <div class="c-name">${ch.name}</div>
      <div class="c-tag">${ch.tag||'CUSTOM'}</div>
    </div>`).join('');
  g.querySelectorAll('.card').forEach(card => {
    const i = +card.dataset.i;
    let timer;
    card.addEventListener('click', () => loadChannel(channels[i].url, i));
    card.addEventListener('touchstart', () => { timer=setTimeout(()=>delChannel(i),700); },{passive:true});
    card.addEventListener('touchend',   () => clearTimeout(timer),{passive:true});
    card.addEventListener('touchmove',  () => clearTimeout(timer),{passive:true});
    card.addEventListener('contextmenu',e  => { e.preventDefault(); delChannel(i); });
  });
}

function delChannel(i){
  if(!confirm(`¬øEliminar "${channels[i].name}"?`)) return;
  channels.splice(i,1); saveChannels();
  if(activeIdx===i) activeIdx=-1; else if(activeIdx>i) activeIdx--;
  renderGrid(); toast('üóëÔ∏è Canal eliminado');
}

function openModal() { document.getElementById('modalBg').classList.add('open'); }
function closeModal(){ document.getElementById('modalBg').classList.remove('open'); }
function saveChannel(){
  const name = document.getElementById('mName').value.trim();
  const url  = document.getElementById('mUrl').value.trim();
  const icon = document.getElementById('mIcon').value.trim() || 'üì∫';
  if(!name||!url){ toast('‚ö†Ô∏è Nombre y URL son obligatorios'); return; }
  channels.push({name,url,icon,tag:'CUSTOM'});
  saveChannels(); renderGrid(); closeModal();
  ['mName','mUrl','mIcon'].forEach(id=>document.getElementById(id).value='');
  toast('‚úÖ Canal guardado');
}
document.getElementById('modalBg').addEventListener('click',function(e){if(e.target===this)closeModal();});

let _tt;
function toast(msg){
  const el=document.getElementById('toast');
  el.textContent=msg; el.classList.add('show');
  clearTimeout(_tt); _tt=setTimeout(()=>el.classList.remove('show'),2800);
}

// INIT
loadChannels();
renderGrid();
showState('ph');
registerSW();
</script>
</body>
</html>
